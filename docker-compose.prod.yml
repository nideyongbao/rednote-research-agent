services:
  # xiaohongshu-mcp 服务
  xiaohongshu-mcp:
    image: xpzouying/xiaohongshu-mcp
    container_name: xiaohongshu-mcp
    restart: unless-stopped
    init: true
    tty: true
    volumes:
      - ./data:/app/data # 统一挂载
      - ./output:/app/output # 共享输出
    environment:
      - ROD_BROWSER_BIN=/usr/bin/google-chrome
      - COOKIES_PATH=/app/data/mcp/cookies.json
    ports:
      - "18060:18060"
    networks:
      - rednote-network

  # 研究代理服务 (纯镜像模式，无构建上下文)
  rednote-research:
    image: brooksli1/rednote-research-agent:latest
    container_name: rednote-research
    ports:
      - "8000:8000"
    env_file:
      - .env.docker
    environment:
      - PYTHONUNBUFFERED=1
      - XIAOHONGSHU_MCP_URL=http://xiaohongshu-mcp:18060
      - HISTORY_STORAGE_PATH=/app/data/history.json
      - PUBLISH_OUTPUT_DIR=/app/output/publish
    volumes:
      - ./reports:/app/reports
      - ./data:/app/data
      - ./output:/app/output
    depends_on:
      - xiaohongshu-mcp
    restart: unless-stopped
    networks:
      - rednote-network

networks:
  rednote-network:
    driver: bridge
