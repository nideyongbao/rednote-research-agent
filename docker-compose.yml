services:
  # xiaohongshu-mcp 服务
  xiaohongshu-mcp:
    image: xpzouying/xiaohongshu-mcp
    container_name: xiaohongshu-mcp
    restart: unless-stopped
    init: true
    tty: true
    volumes:
      - ./data/mcp:/app/data
      - ./data/images:/app/images
    environment:
      - ROD_BROWSER_BIN=/usr/bin/google-chrome
      - COOKIES_PATH=/app/data/cookies.json
    ports:
      - "18060:18060"
    networks:
      - rednote-network

  # 研究代理服务
  rednote-research:
    build:
      context: .
      dockerfile: docker/Dockerfile
    image: brooksli1/rednote-research-agent:latest
    container_name: rednote-research
    ports:
      - "8000:8000"
    env_file:
      - .env.docker
    environment:
      - PYTHONUNBUFFERED=1
      - XIAOHONGSHU_MCP_URL=http://xiaohongshu-mcp:18060
    volumes:
      - ./reports:/app/reports
      - ./data/mcp:/app/data/mcp
    depends_on:
      - xiaohongshu-mcp
    restart: unless-stopped
    networks:
      - rednote-network

networks:
  rednote-network:
    driver: bridge
